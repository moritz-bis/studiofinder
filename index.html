<!DOCTYPE html>
<html lang="eng">
<head>
  <meta charset="UTF-8" />
  <title>studio-finder</title>

  <link rel="stylesheet" href="style.css">

</head>


<body>
  
  <h1>studio-finder</h1>

  <label for="countryFilter">country:</label>
  <select id="countryFilter">
    <option value="all">all countries</option>
  </select>

  <label for="cityFilter">city:</label>
  <select id="cityFilter">
    <option value="all">all cities</option>
  </select>

  <table>
    <thead>
      <tr>
        <th>name</th>
        <th>website</th>
        <th>city</th>
        <th>country</th>
        <th>tags</th>
      </tr>
    </thead>
    <tbody id="studioTableBody"></tbody>
  </table>


  
<script>
  // Globale Variable zum Speichern der kombinierten Studios
  let studios = [];

  // DOM-Elemente
  const tbody = document.getElementById("studioTableBody");
  const countryFilter = document.getElementById("countryFilter");
  const cityFilter = document.getElementById("cityFilter");

  // Studiendaten aus beiden JSON-Dateien laden
  async function loadStudios() {
    try {
      const [deResponse, itResponse] = await Promise.all([
        fetch('studiosDE.json'),
        fetch('studiosIT.json')
      ]);

      const [studiosDE, studiosIT] = await Promise.all([
        deResponse.json(),
        itResponse.json()
      ]);

      // Kombinieren der beiden Arrays
      studios = [...studiosDE, ...studiosIT];

      // Initialisierung von Dropdowns und Tabelle
      initDropdowns(studios);
      renderStudios();
    } catch (error) {
      console.error("Fehler beim Laden der Studiendaten:", error);
    }
  }

  // Einmalig Dropdowns mit eindeutigen Werten befÃ¼llen
  function initDropdowns(studios) {
    const allCountries = new Set();
    const allCities = new Set();

    studios.forEach(studio => {
      studio.country.forEach(c => allCountries.add(c));
      studio.city.forEach(c => allCities.add(c));
    });

    for (const country of Array.from(allCountries).sort()) {
      const opt = document.createElement("option");
      opt.value = country;
      opt.textContent = country;
      countryFilter.appendChild(opt);
    }

    for (const city of Array.from(allCities).sort()) {
      const opt = document.createElement("option");
      opt.value = city;
      opt.textContent = city;
      cityFilter.appendChild(opt);
    }
  }

  // Studios nach Filter anzeigen
  function renderStudios() {
    const selectedCountry = countryFilter.value;
    const selectedCity = cityFilter.value;

    const filtered = studios.filter(studio => {
      const countryMatch = selectedCountry === "all" || studio.country.includes(selectedCountry);
      const cityMatch = selectedCity === "all" || studio.city.includes(selectedCity);
      return countryMatch && cityMatch;
    });

    // Tabelle leeren
    tbody.innerHTML = "";

    // Studios eintragen
    filtered.forEach(studio => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${studio.name}</td>
        <td><a href="${studio.website}" target="_blank">${studio.website}</a></td>
        <td>${studio.city.join(', ')}</td>
        <td>${studio.country.join(', ')}</td>
        <td>${studio.tags.map(tag => `<span class="tag">${tag}</span>`).join(' ')}</td>
      `;
      tbody.appendChild(row);
    });
  }

  // Filter-Events
  countryFilter.addEventListener("change", renderStudios);
  cityFilter.addEventListener("change", renderStudios);

  // Daten laden und starten
  loadStudios();
</script>

<script data-goatcounter="https://studio-finder.goatcounter.com/count"
  async src="//gc.zgo.at/count.js">
</script>

</body>
</html>