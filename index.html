<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>studio-finder</title>

  <link rel="stylesheet" href="style.css">

</head>


<body>
  <h1>studio-finder</h1>

  <select id="countryFilter">
    <!-- <option value="all">all countries</option>
    <option value="DE">Germany</option>
    <option value="IT">Italy</option>
    <option value="INT">International</option> -->
  </select>

  <select id="cityFilter">
    <!-- <option value="all">Alle Städte</option>
    <option value="Berlin">Berlin</option>
    <option value="Munich">Munich</option>
    <option value="Rome">Milan</option> -->
  </select>

  <!-- <h2>Alle Studios</h2> -->
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Website</th>
        <th>Stadt</th>
        <th>Tags</th>
        <th>Land</th>
      </tr>
    </thead>
    <tbody id="all-studios"></tbody>
  </table>


  
<script>
  let alleStudios = [];

  async function studiosTable() {
    const dateien = [
      'studiosDE.json',
      'studiosIT.json',
      'studiosINT.json'
    ];

    const alle = [];

    for (const dateiname of dateien) {
      try {
        const response = await fetch(dateiname);
        const daten = await response.json();
        alle.push(...daten);
      } catch (error) {
        console.error(`Fehler beim Laden von ${dateiname}:`, error);
      }
    }

    alleStudios = alle;

    baueFilterOptionen(alleStudios); // dynamische Filter erstellen
    zeigeStudios(alleStudios);      // initiale Anzeige
  }

  function baueFilterOptionen(studios) {
    const countrySet = new Set();
    const citySet = new Set();

    studios.forEach(studio => {
      if (studio.country) countrySet.add(studio.country);
      if (studio.city) citySet.add(studio.city);
    });

    const countrySelect = document.getElementById('countryFilter');
    const citySelect = document.getElementById('cityFilter');

    // Hilfsfunktion zum Hinzufügen von Optionen
    function addOptions(selectElement, values) {
      selectElement.innerHTML = '<option value="all">Alle</option>';
      [...values].sort().forEach(value => {
        const option = document.createElement('option');
        option.value = value;
        option.textContent = value;
        selectElement.appendChild(option);
      });
    }

    addOptions(countrySelect, countrySet);
    addOptions(citySelect, citySet);
  }

  function zeigeStudios(studios) {
    const tbody = document.getElementById('all-studios');
    tbody.innerHTML = '';

    studios.sort((a, b) => a.name.localeCompare(b.name));

    studios.forEach(studio => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${studio.name}</td>
        <td><a href="${studio.website}" target="_blank">${studio.website}</a></td>
        <td>${studio.city}</td>
        <td>${studio.tags.join(', ')}</td>
        <td>${studio.country}</td>
      `;
      tbody.appendChild(row);
    });
  }

  function applyFilter() {
    const land = document.getElementById('countryFilter').value;
    const stadt = document.getElementById('cityFilter').value;

    let gefiltert = alleStudios;

    if (land !== 'all') {
      gefiltert = gefiltert.filter(s => s.country === land);
    }

    if (stadt !== 'all') {
      gefiltert = gefiltert.filter(s => s.city === stadt);
    }

    zeigeStudios(gefiltert);
  }

  document.getElementById('countryFilter').addEventListener('change', applyFilter);
  document.getElementById('cityFilter').addEventListener('change', applyFilter);

  studiosTable(); // Start
</script>

</body>
</html>